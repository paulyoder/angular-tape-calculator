(function(){window.TapeCalculator=function(){function e(e){this.opened=e.opened,this.closed=e.closed,this.tapeChanged=e.tapeChanged,this.isOpen=!1,this.clear(!0)}return e.binaryOperators={"+":function(e){return e.accum+=e.value},"-":function(e){return e.accum-=e.value},"*":function(e){return e.accum*=e.value},"/":function(e){return e.accum/=e.value}},e.isOperator=function(e){return"="===e||"C"===e||null!=TapeCalculator.binaryOperators[e]},e.prototype.open=function(){return this.isOpen?void 0:(this.isOpen=!0,this.opened())},e.prototype.close=function(){return this.isOpen?(this.clear(!0),this.isOpen=!1,this.closed()):void 0},e.prototype.clear=function(e){return this.accum=0,this.value=null,e?this.tape=[]:void 0},e.prototype.getLastTapeLine=function(){var e;return e=this.tape.length,0===e?null:this.tape[e-1]},e.prototype.reduce=function(){var e;return e=this.getLastTapeLine(),null==(null!=e?e.operator:void 0)?!1:(e.value=this.value,e.operator(this),!0)},e.prototype.handleKey=function(e,t){var a,l,n,r,u;switch(this.value=null!=(u=null!=t?t:this.value)?u:0,e){case"=":this.reduce()?(this.tape.push({symbol:"=",value:this.accum}),this.value=l=this.accum):(n=this.getLastTapeLine(),(null==n||""===n.symbol&&n.value!==this.value)&&(this.accum=this.value,this.tape.push({symbol:"",value:this.value})));break;case"C":n=this.getLastTapeLine(),a=null==n||"C"===n.symbol,this.clear(a),a||this.tape.push({value:0,symbol:"C"}),l="";break;default:if(r=TapeCalculator.binaryOperators[e],null==r)return null;n=this.getLastTapeLine(),this.reduce()||null!=n&&n.value===this.value||(this.accum=this.value,this.tape.push({symbol:"",value:this.value})),this.tape.push({symbol:e,operator:r,value:null}),l=""}return this.open(),this.tapeChanged(this.tape),l},e}()}).call(this),function(){angular.module("tape-calculator",[]).directive("ngTapeCalculator",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a){var l,n,r,u,i,o,c,s,p,h;return p=void 0,s=void 0,c=function(){var e,a;return e=t[0].getBoundingClientRect(),p=angular.element("<div class='tape-calculator-wrapper'></div>"),angular.element(document.body).append(p),a=e.left+e.width-p.width,p.css("left",""+a+"px"),p.css("top",""+e.top+"px"),s=angular.element("<div class='tape-calculator-container'></div>"),p.append(s),s=s[0]},i=function(){return p.remove(),p=void 0,s=void 0},l=function(e){return null==e?"":e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},u={"=":"tape-calculator-line-equals",C:"tape-calculator-line-equals"},o=function(e){var t,a,n,r;for(t="",n=0,r=e.length;r>n;n++)a=e[n],t+="<div class='clearfix "+u[a.symbol]+"'> <div class='tape-calculator-number'> "+l(a.value)+" </div> <div class='tape-calculator-operator'> "+a.symbol+" </div> </div>";return s.innerHTML=t},r=function(){return parseFloat(t.val())||null},n=function(){var t;return t=r(),e.calculator.handleKey("=",t)},h=function(){var t;return t=e.calculator.accum,e.$eval(""+a.ngModel+" = "+t),e.$apply(),e.calculator.close()},t.on("blur",function(){var t;return(null!=(t=e.calculator)?t.isOpen:void 0)?(n(),h()):void 0}),t.on("keydown",function(a){var l,u,i;if(!(null!=(i=e.calculator)?i.isOpen:void 0))return!0;switch(a.which){case 13:return u=r(),"="===e.calculator.getLastTapeLine().symbol?(n(),h()):(l=n(),t.val(l)),!1;case 27:return h(),!1}return!0}),t.on("keypress",function(a){var l,n,u,s;return u=String.fromCharCode(a.which).toUpperCase(),s=a.target.selectionStart===a.target.selectionEnd&&0!==t.val().length&&a.target.selectionStart===t.val().length,!TapeCalculator.isOperator(u)||"-"===u&&!s?!0:(null==e.calculator&&(e.calculator=new TapeCalculator({opened:c,closed:i,tapeChanged:o})),n=r(),l=e.calculator.handleKey(u,n),null!=l?(t.val(l),a.preventDefault(),!1):!0)})}}})}.call(this);